<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stardew Logbook - å”ä½œç‰ˆæ—¥èªŒ (v3.1)</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Stardew é¡è‰²è¨­å®š */
            --stardew-green: #4c7c34;
            --stardew-brown: #a0785a;
            --stardew-light-brown: #cfc29c;
            --stardew-cream: #fcfbe7;
            --stardew-dark: #2a2a2a;
            --stardew-red: #c94c4c;
            --stardew-gold: #ffc300;
            --stardew-blue: #5b7999; /* LL çš„é¡è‰² */
            --stardew-pink: #cc99a3; /* KK çš„é¡è‰² */
            --stardew-purple: #9a67a5; /* ç¸½çµçš„é¡è‰² */
            --pixel-size: 2px;
            --page-width: 800px;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            image-rendering: pixelated;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--stardew-green);
            background-image: repeating-linear-gradient(45deg, var(--stardew-green) 0, var(--stardew-green) 10px, var(--stardew-dark) 10px, var(--stardew-dark) 11px),
                              repeating-linear-gradient(-45deg, var(--stardew-green) 0, var(--stardew-green) 10px, var(--stardew-dark) 10px, var(--stardew-dark) 11px);
            background-size: 20px 20px;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
            color: var(--stardew-dark);
        }

        /* --- æ›¸æœ¬å®¹å™¨ (Wrapper) --- */
        .journal-window {
            width: var(--page-width);
            height: 90vh;
            background-color: var(--stardew-cream);
            padding: 20px;
            position: relative;
            overflow: hidden;

            border: calc(var(--pixel-size) * 4) solid var(--stardew-brown);
            box-shadow:
                calc(var(--pixel-size) * 4) calc(var(--pixel-size) * 4) 0 0 var(--stardew-dark),
                calc(var(--pixel-size) * 8) calc(var(--pixel-size) * 8) 0 0 var(--stardew-light-brown),
                inset 0 0 0 2px var(--stardew-light-brown);
        }

        /* --- è¦–åœ–åˆ‡æ›å™¨ (ç”¨æ–¼å‹•ç•«) --- */
        #view-switcher {
             position: relative;
             height: calc(100% - 70px);
             perspective: 1500px;
        }

        #view-switcher > div {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            padding: 20px;
            background-color: var(--stardew-cream);
            transition: transform 0.6s ease-in-out, opacity 0.6s ease-in-out;
            transform-origin: left;
            overflow-y: auto;
            backface-visibility: hidden;
        }

        .view-hidden { opacity: 0; z-index: 10; pointer-events: none; transform: rotateY(-90deg); }
        .view-active { opacity: 1; z-index: 20; pointer-events: all; transform: rotateY(0deg); }

        /* --- é ‚éƒ¨ç‹€æ…‹æ¬„ --- */
        .stat-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 10px 0; border-bottom: var(--pixel-size) solid var(--stardew-dark); }
        .settings-btn { background-color: var(--stardew-light-brown); color: var(--stardew-dark); padding: 4px 8px; font-size: 10px; cursor: pointer; border: var(--pixel-size) solid var(--stardew-dark); box-shadow: 2px 2px 0 0 var(--stardew-dark); transition: all 0.1s; }
        .settings-btn:hover { background-color: var(--stardew-gold); transform: translate(-1px, -1px); }

        .love-value { font-size: 10px; background: var(--stardew-pink); padding: 4px 8px; color: #fff; border: var(--pixel-size) solid var(--stardew-dark); box-shadow: 2px 2px 0 0 var(--stardew-dark); }
        .stat-item { display: flex; align-items: center; font-size: 10px; }
        .stat-icon { font-size: 18px; margin-right: 5px; }

        /* --- æ—¥æ›†ç›¸é—œæ¨£å¼ --- */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; font-size: 10px; }
        .day-header { text-align: center; color: var(--stardew-brown); padding: 5px; }
        .day-cell { height: 80px; padding: 5px; text-align: right; cursor: pointer; position: relative; background-color: #fff; border: var(--pixel-size) solid var(--stardew-light-brown); box-shadow: 1px 1px 0 0 var(--stardew-light-brown); transition: background-color 0.1s, transform 0.1s; }
        .day-cell:not(.empty-cell):hover { background-color: var(--stardew-gold); transform: translate(-1px, -1px); }
        .empty-cell { background-color: #f0f0f0; cursor: default; border: none; box-shadow: none; }
        .has-entry { background-color: var(--stardew-pink); color: #fff; font-weight: bold; }

        /* æœˆæœ«ç¸½çµæ¨™è¨˜ */
        .is-month-end { border: 4px dashed var(--stardew-purple); font-weight: bold; }
        .is-month-end:hover { background-color: var(--stardew-purple) !important; color: #fff; }
        .is-month-end .count { background: var(--stardew-gold) !important; color: var(--stardew-dark); }

        .day-cell .count { position: absolute; top: 5px; left: 5px; font-size: 8px; background: rgba(0,0,0,0.2); padding: 1px 3px; border-radius: 2px; }

        /* --- å–®æ—¥é é¢ --- */
        .timeline-content { display: flex; flex-direction: column; gap: 20px; padding-top: 20px; }

        /* --- èŠå¤©æ°£æ³¡æ¨£å¼ --- */
        .memory-entry { width: 70%; padding: 15px; margin-bottom: 10px; transition: all 0.3s; position: relative; border: var(--pixel-size) solid var(--stardew-dark); box-shadow: var(--pixel-size) var(--pixel-size) 0 0 var(--stardew-dark); }
        .author-LL { margin-right: auto; background-color: var(--stardew-blue); color: #fff; }
        .author-KK { margin-left: auto; background-color: var(--stardew-pink); color: var(--stardew-dark); }

        /* --- æœˆæœ«ç¸½çµå…§å®¹é¡¯ç¤º --- */
        .entry-month-summary {
            width: 90%;
            margin: 20px auto;
            padding: 25px;
            background-color: var(--stardew-purple);
            color: #fff;
            border: 4px solid var(--stardew-dark);
            box-shadow: 6px 6px 0 0 var(--stardew-dark);
        }
        .summary-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .summary-header h3 { font-size: 14px; text-align: center; margin: 0; flex-grow: 1; }

        .summary-content-wrapper { display: flex; gap: 20px; }
        .summary-section-column { flex: 1; display: flex; flex-direction: column; }
        .summary-section { margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed rgba(255, 255, 255, 0.3); }
        .summary-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .summary-section h4 { font-size: 9px; margin-bottom: 3px; color: var(--stardew-gold); }
        .summary-section p { font-size: 8px; line-height: 1.4; margin: 0; color: var(--stardew-cream); word-break: break-word; }

        /* --- Modal & Form Styles --- */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 100; }
        .crafting-menu { width: 500px; background-color: var(--stardew-cream); padding: 30px; border: calc(var(--pixel-size) * 4) solid var(--stardew-brown); box-shadow: calc(var(--pixel-size) * 4) calc(var(--pixel-size) * 4) 0 0 var(--stardew-dark), calc(var(--pixel-size) * 8) calc(var(--pixel-size) * 8) 0 0 var(--stardew-light-brown); }
        .form-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .form-group { flex-grow: 1; display: flex; flex-direction: column; }
        .form-group label { font-size: 8px; margin-bottom: 5px; color: var(--stardew-brown); }
        .form-group input, .form-group select, .form-group textarea { padding: 5px; font-family: sans-serif; font-size: 12px; border: var(--pixel-size) solid var(--stardew-dark); }
        .form-group textarea { resize: vertical; min-height: 100px; }

        /* æœˆæœ«ç¸½çµè¡¨å–®ç‰¹åŒ– (æ ¸å¿ƒèª¿æ•´) */
        #summary-modal .crafting-menu { width: 700px; } /* åŠ å¯¬ Modal */
        #summary-form .form-group { margin-bottom: 10px; }
        #summary-form textarea { min-height: 60px; font-size: 11px; font-family: sans-serif; }

        .summary-form-section-wrapper { display: flex; gap: 15px; margin-bottom: 20px; } /* è®“å…©éƒ¨åˆ†ä¸¦æ’ */
        .summary-author-form-section {
            flex: 1;
            padding: 15px;
            border: var(--pixel-size) solid var(--stardew-dark);
            position: relative;
            background-color: #fff;
        }
        .summary-author-form-section h4 {
            font-size: 10px;
            text-align: center;
            background: var(--stardew-cream);
            padding: 5px;
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: fit-content;
            border: var(--pixel-size) solid var(--stardew-dark);
            box-shadow: 2px 2px 0 0 var(--stardew-dark);
        }
        .summary-author-form-section.ll-section h4 { color: var(--stardew-blue); }
        .summary-author-form-section.kk-section h4 { color: var(--stardew-pink); }

        /* --- çµ±ä¸€çš„åƒç´ é¢¨æ ¼æŒ‰éˆ• (btn-pixel) --- */
        .btn-pixel {
            background-color: var(--stardew-light-brown);
            color: var(--stardew-dark);
            padding: 8px 12px;
            font-size: 10px;
            cursor: pointer;
            border: var(--pixel-size) solid var(--stardew-dark);
            box-shadow: 2px 2px 0 0 var(--stardew-dark);
            transition: all 0.1s;
            line-height: 1;
            font-family: 'Press Start 2P', cursive;
        }
        .btn-pixel:hover { background-color: var(--stardew-gold); color: var(--stardew-dark); box-shadow: 3px 3px 0 0 var(--stardew-dark); transform: translate(-1px, -1px); }
        .btn-pixel:active { transform: translate(1px, 1px); box-shadow: 1px 1px 0 0 var(--stardew-dark); }

        .add-btn { position: fixed; bottom: 30px; right: 30px; width: 120px; height: 40px; line-height: 20px; text-align: center; background-color: var(--stardew-gold); color: var(--stardew-dark); cursor: pointer; z-index: 50; }

        .file-upload-btn { background-color: var(--stardew-blue); color: #fff; padding: 8px 12px; font-size: 10px; cursor: pointer; border: var(--pixel-size) solid var(--stardew-dark); box-shadow: 2px 2px 0 0 var(--stardew-dark); display: inline-block; margin-top: 5px; }
        .file-upload-btn:hover { background-color: #4a6785; }
        #entry-image { display: none; }

        /* è¿”å›æŒ‰éˆ•çš„çµ±ä¸€é¢¨æ ¼ */
        .back-btn {
            position: absolute; top: 5px; left: 25px;
            z-index: 30;
            background-color: var(--stardew-light-brown);
            color: var(--stardew-dark);
            padding: 5px 8px;
            font-size: 10px;
            cursor: pointer;
            border: var(--pixel-size) solid var(--stardew-dark);
            box-shadow: 2px 2px 0 0 var(--stardew-dark);
            transition: all 0.1s;
            line-height: 1;
        }
        .back-btn:hover { background-color: var(--stardew-gold); transform: translate(-1px, -1px); }
        .back-btn:active { transform: translate(1px, 1px); box-shadow: 1px 1px 0 0 var(--stardew-dark); }

        /* åˆªé™¤æŒ‰éˆ•çš„çµ±ä¸€é¢¨æ ¼ */
        .delete-btn {
            background-color: var(--stardew-red);
            color: #fff;
            font-size: 8px;
            padding: 2px 5px;
            margin-left: 10px;
            border: var(--pixel-size) solid var(--stardew-dark);
            cursor: pointer;
            box-shadow: 1px 1px 0 0 var(--stardew-dark);
            transition: background-color 0.1s;
            line-height: 1;
        }
        .delete-btn:hover { background-color: darkred; box-shadow: 2px 2px 0 0 var(--stardew-dark); }
        .delete-btn:active { transform: translate(1px, 1px); box-shadow: 0 0 0 0 var(--stardew-dark); }

    </style>
</head>
<body>

    <div class="journal-window">

        <div class="stat-bar">
             <button class="settings-btn btn-pixel" onclick="openSettingsModal()">âš™ï¸ SETTINGS</button>
            <div class="love-value" id="love-value">
                â¤ï¸ LOVE: 0
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ“…</span>
                <span style="font-size: 8px;" id="current-date"></span>
            </div>
        </div>

        <div id="view-switcher">

            <div id="calendar-view" class="view-active">
                <header style="text-align: center; margin-bottom: 30px;">
                    <h1 style="font-size: 20px; margin: 0; color: var(--stardew-dark);">CALENDAR</h1>
                    <div id="current-month-year"></div>
                </header>
                <div class="calendar-grid" id="calendar-grid">
                    </div>
            </div>

            <div id="day-view" class="view-hidden">
                <button class="back-btn" onclick="navigateTo('calendar')">â† BACK</button>
                <h2 id="day-title" style="font-size: 16px; text-align: center; margin-bottom: 20px;"></h2>
                <div class="timeline-content" id="day-timeline-content">
                    </div>
            </div>

        </div>

    </div>

    <button class="add-btn btn-pixel" onclick="openForm()">+ NEW LOG</button>

    <!-- æ™®é€šæ—¥èªŒè¡¨å–® Modal -->
    <div class="modal-overlay" id="crafting-modal">
        <div class="crafting-menu">
            <h2>CRAFT NEW ENTRY</h2>
            <form id="entry-form">

                <div class="form-row">
                    <div class="form-group"><label for="entry-author">RECORDER (è¨˜äº‹äºº)</label><select id="entry-author" required><option value="LL">LL</option><option value="KK">KK</option></select></div>
                    <div class="form-group"><label for="entry-date">DATE (æ—¥æœŸ)</label><input type="date" id="entry-date" required></div>
                </div>

                <div class="form-row">
                    <div class="form-group"><label for="entry-weather">WEATHER (å¤©æ°£)</label>
                        <select id="entry-weather" required>
                            <option value="â˜€ï¸">æ™´å¤© (Sunny) â˜€ï¸</option>
                            <option value="â˜ï¸">å¤šé›² (Cloudy) â˜ï¸</option>
                            <option value="ğŸ’¨">é¢³é¢¨ (Windy) ğŸ’¨</option>
                            <option value="ğŸŒ§ï¸">ä¸‹é›¨ (Rainy) ğŸŒ§ï¸</option>
                            <option value="â„ï¸">ä¸‹é›ª (Snowy) â„ï¸</option>
                        </select>
                    </div>
                    <div class="form-group"><label for="entry-mood">MOOD (å¿ƒæƒ…)</label>
                        <select id="entry-mood" required>
                            <option value="ğŸ˜„">é–‹å¿ƒ (Happy)</option>
                            <option value="ğŸ™‚">å¹³éœ (Calm)</option>
                            <option value="ğŸ˜¥">é›£é (Sad)</option>
                            <option value="ğŸ˜¡">ç”Ÿæ°£ (Angry)</option>
                            <option value="ğŸ˜´">ç–²æ†Š (Tired)</option>
                            <option value="âœ¨">èˆˆå¥® (Excited)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex-grow: 2;"><label for="entry-title">TITLE / SHORT CAPTION (æ¨™é¡Œ)</label><input type="text" id="entry-title" required maxlength="50"></div>
                    <div class="form-group"><label for="entry-type">ENTRY TYPE (å½¢å¼)</label>
                        <select id="entry-type" required onchange="toggleContentRequired()">
                            <option value="text">TEXT LOG (æ–‡å­—)</option>
                            <option value="photo">PHOTO MEMORY (åœ–ç‰‡)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" id="content-text-group">
                    <label for="entry-content">MAIN CONTENT (ä¸»è¦å…§å®¹)</label>
                    <textarea id="entry-content" required></textarea>
                </div>

                <div class="form-group" id="file-upload-group">
                    <label for="entry-image">ATTACH PHOTO (åœ–ç‰‡æª”æ¡ˆ)</label>
                    <label for="entry-image" class="file-upload-btn" id="file-label" style="width: 100%; text-align: center;">CLICK TO SELECT FILE ğŸ“·</label>
                    <input type="file" id="entry-image" accept="image/*">
                </div>

                <div class="form-actions" style="display:flex; justify-content: space-between; margin-top: 20px;">
                    <button type="button" class="btn-pixel" onclick="closeForm()">CLOSE</button>
                    <button type="submit" class="btn-pixel" style="background-color: var(--stardew-green); color:#fff;">LOG IT!</button>
                </div>
            </form>
        </div>
    </div>

    <!-- è¨­å®š Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="crafting-menu" style="width: 450px;">
            <h2>SETTINGS / DATA TRANSFER</h2>
             <div class="setting-option">
                <h3>EXPORT LOGS (åŒ¯å‡ºæ—¥èªŒ)</h3>
                <p style="font-size: 10px; margin-bottom: 10px; line-height: 1.4;">å°‡æ‰€æœ‰æ—¥èªŒå…§å®¹æ‰“åŒ…æˆä¸€å€‹ `.json` æª”æ¡ˆã€‚é€™æ˜¯æ‚¨èˆ‡å”ä½œè€…å…±äº«é€²åº¦çš„æ–¹å¼ã€‚</p>
                <button class="btn-pixel" style="background-color: var(--stardew-gold); color: var(--stardew-dark);" onclick="exportLogs()">DOWNLOAD .JSON</button>
            </div>

            <div class="setting-option" style="margin-top: 20px;">
                <h3>IMPORT LOGS (åŒ¯å…¥æ—¥èªŒ)</h3>
                <p style="font-size: 10px; margin-bottom: 10px; line-height: 1.4;">ä¸Šå‚³ä¸€å€‹ `.json` æª”æ¡ˆä¾†è¦†è“‹æœ¬åœ°å„²å­˜çš„æ—¥èªŒã€‚**è­¦å‘Šï¼šé€™å°‡å–ä»£æ‚¨æ‰€æœ‰çš„æœ¬åœ°ç´€éŒ„ï¼**</p>
                <input type="file" id="import-file-input" accept=".json" style="display: none;">
                <label for="import-file-input" class="file-upload-btn">
                    UPLOAD & IMPORT FILE
                </label>
            </div>

            <div class="setting-option" style="margin-top: 20px;">
                <h3>WIPE ALL DATA (æ¸…é™¤æ•¸æ“š)</h3>
                <p style="font-size: 10px; margin-bottom: 10px; line-height: 1.4;">å¦‚æœæ‚¨æƒ³å¾é ­é–‹å§‹æˆ–æ¸…ç†æœ¬åœ°å„²å­˜ï¼Œè«‹é»æ“Šæ­¤è™•ã€‚**æ­¤æ“ä½œä¸å¯é€†ï¼**</p>
                <button type="button" class="btn-pixel" style="background-color: var(--stardew-red); color: #fff;" onclick="wipeData()">WIPE LOCAL DATA</button>
            </div>

            <div class="form-actions" style="display:flex; justify-content: end; margin-top: 20px;">
                <button type="button" class="btn-pixel" onclick="closeSettingsModal()">CLOSE</button>
            </div>
        </div>
    </div>

    <!-- æœˆæœ«ç¸½çµ Modal -->
    <div class="modal-overlay" id="summary-modal">
        <div class="crafting-menu" style="width: 700px;">
            <h2 id="summary-month-title" style="text-align: center;"></h2>
            <form id="summary-form">

                <div class="summary-form-section-wrapper">
                    <div class="summary-author-form-section ll-section">
                        <h4>LL'S SECTION</h4>
                        <div class="form-group"><label>æœ¬æœˆå¾©ç›¤ (LL)</label><textarea id="summary-ll-review" required></textarea></div>
                        <div class="form-group"><label>å¾…æ”¹é€² (LL)</label><textarea id="summary-ll-improve" required></textarea></div>
                        <div class="form-group"><label>å° KK çš„æœŸå¾… (LL)</label><textarea id="summary-ll-expect" required></textarea></div>
                    </div>

                    <div class="summary-author-form-section kk-section">
                        <h4>KK'S SECTION</h4>
                        <div class="form-group"><label>æœ¬æœˆå¾©ç›¤ (KK)</label><textarea id="summary-kk-review" required></textarea></div>
                        <div class="form-group"><label>å¾…æ”¹é€² (KK)</label><textarea id="summary-kk-improve" required></textarea></div>
                        <div class="form-group"><label>å° LL çš„æœŸå¾… (KK)</label><textarea id="summary-kk-expect" required></textarea></div>
                    </div>
                </div>

                <div class="form-actions" style="display:flex; justify-content: space-between; margin-top: 20px;">
                    <button type="button" class="btn-pixel" onclick="closeSummaryModal()">CLOSE</button>
                    <button type="submit" class="btn-pixel" style="background-color: var(--stardew-purple); color:#fff;">SUBMIT SUMMARY</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // --- Setup & Global Variables ---
        const MODAL = document.getElementById('crafting-modal');
        const SETTINGS_MODAL = document.getElementById('settings-modal');
        const SUMMARY_MODAL = document.getElementById('summary-modal');
        const FORM = document.getElementById('entry-form');
        const SUMMARY_FORM = document.getElementById('summary-form');
        const CALENDAR_GRID = document.getElementById('calendar-grid');
        const DAY_TIMELINE = document.getElementById('day-timeline-content');
        const CALENDAR_VIEW = document.getElementById('calendar-view');
        const DAY_VIEW = document.getElementById('day-view');

        const FILE_INPUT = document.getElementById('entry-image');
        const FILE_LABEL = document.getElementById('file-label');
        const IMPORT_FILE_INPUT = document.getElementById('import-file-input');

        const ENTRY_TYPE_SELECT = document.getElementById('entry-type');
        const CONTENT_TEXTAREA = document.getElementById('entry-content');
        const CONTENT_TEXT_GROUP = document.getElementById('content-text-group');

        const STORAGE_KEY = 'stardewFarmLogEntriesV3';
        const SUMMARY_TYPE = 'month_summary';
        let allEntries = [];
        const LOVE_VALUE_PER_ENTRY = 5;

        let currentDisplayYear;
        let currentDisplayMonth;
        let currentSummaryDateStr = null;


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            currentDisplayYear = today.getFullYear();
            currentDisplayMonth = today.getMonth();

            document.getElementById('current-date').textContent = getFormattedDate(today, 'YYYY/MM/DD');
            loadAndRenderAll();
            navigateTo('calendar');

            IMPORT_FILE_INPUT.addEventListener('change', importLogs);

            FORM.addEventListener('submit', handleEntrySubmit);
            SUMMARY_FORM.addEventListener('submit', handleSummarySubmit);
        });

        function loadAndRenderAll() {
            // å¾ localStorage åŠ è¼‰æ—¥èªŒ
            allEntries = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            calculateLoveValue();
            renderCalendar();
        }

        function calculateLoveValue() {
            // è¨ˆç®—æ„›å¿ƒå€¼ï¼šæ¯æœˆç¸½çµä¸è¨ˆå…¥ï¼Œåªè¨ˆå…¥æ™®é€šæ—¥èªŒ
            const logEntries = allEntries.filter(e => e.type !== SUMMARY_TYPE);
            const totalLove = logEntries.length * LOVE_VALUE_PER_ENTRY;
            document.getElementById('love-value').textContent = `â¤ï¸ LOVE: ${totalLove}`;
        }

        // --- è¦–åœ–åˆ‡æ›èˆ‡å°èˆª ---
        function navigateTo(view, dateStr = null) {
            if (view === 'day' && dateStr) {
                renderDayView(dateStr);
                CALENDAR_VIEW.classList.remove('view-active');
                CALENDAR_VIEW.classList.add('view-hidden');
                DAY_VIEW.classList.remove('view-hidden');
                DAY_VIEW.classList.add('view-active');

            } else if (view === 'calendar') {
                const today = new Date();
                document.getElementById('current-date').textContent = getFormattedDate(today, 'YYYY/MM/DD');

                // åªæœ‰åœ¨å›åˆ°æ—¥æ›†æ™‚æ‰é‡ç½®åˆ°ç•¶å‰æœˆä»½
                // è¨»é‡‹æ‰é€™è¡Œä»¥ä¿æŒç”¨æˆ¶å°èˆªçš„æœˆä»½
                // currentDisplayYear = today.getFullYear();
                // currentDisplayMonth = today.getMonth();
                renderCalendar();

                DAY_VIEW.classList.remove('view-active');
                DAY_VIEW.classList.add('view-hidden');
                CALENDAR_VIEW.classList.remove('view-hidden');
                CALENDAR_VIEW.classList.add('view-active');
            }
        }

        function prevMonth() { currentDisplayMonth--; if (currentDisplayMonth < 0) { currentDisplayMonth = 11; currentDisplayYear--; } renderCalendar(); }
        function nextMonth() { currentDisplayMonth++; if (currentDisplayMonth > 11) { currentDisplayMonth = 0; currentDisplayYear++; } renderCalendar(); }
        window.prevMonth = prevMonth;
        window.nextMonth = nextMonth;

        // --- æ—¥æ›†æ¸²æŸ“ ---
        function renderCalendar() {
            const year = currentDisplayYear;
            const month = currentDisplayMonth;

            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const lastDayDateKey = getFormattedDate(new Date(year, month, daysInMonth), 'YYYY-MM-DD');

            const entriesByDate = allEntries.reduce((acc, entry) => {
                const dateKey = entry.dateStr;
                if (!acc[dateKey]) acc[dateKey] = { logs: 0, summary: false };
                if (entry.type === SUMMARY_TYPE) {
                    acc[dateKey].summary = true;
                } else {
                    acc[dateKey].logs++;
                }
                return acc;
            }, {});

            document.getElementById('current-month-year').innerHTML = `
                <button class="btn-pixel" style="padding: 4px 8px; font-size: 8px; margin-right: 15px;" onclick="prevMonth()">â†</button>
                <span style="font-size: 14px; color: var(--stardew-brown);">${year} / ${month + 1}</span>
                <button class="btn-pixel" style="padding: 4px 8px; font-size: 8px; margin-left: 15px;" onclick="nextMonth()">â†’</button>
            `;

            CALENDAR_GRID.innerHTML = '';

            // èª¿æ•´æ—¥æ›†çš„ç¬¬ä¸€å¤©ç‚ºå‘¨æ—¥ (getDay() è¿”å› 0-6ï¼Œ0=å‘¨æ—¥)
            const firstDayOfWeek = new Date(year, month, 1).getDay();
            const dayNames = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];

            dayNames.forEach(day => { const header = document.createElement('div'); header.className = 'day-header'; header.textContent = day; CALENDAR_GRID.appendChild(header); });
            for (let i = 0; i < firstDayOfWeek; i++) { const empty = document.createElement('div'); empty.className = 'empty-cell'; CALENDAR_GRID.appendChild(empty); }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateKey = getFormattedDate(date, 'YYYY-MM-DD');
                const cell = document.createElement('div');
                cell.className = 'day-cell';
                cell.textContent = day;
                cell.dataset.date = dateKey;

                const dayData = entriesByDate[dateKey] || { logs: 0, summary: false };

                if (dayData.logs > 0 || dayData.summary) {
                    cell.classList.add('has-entry');
                    const countSpan = document.createElement('span');
                    const totalCount = dayData.logs + (dayData.summary ? 1 : 0);
                    countSpan.className = 'count';
                    countSpan.textContent = `${totalCount} Log${totalCount > 1 ? 's' : ''}`;
                    cell.appendChild(countSpan);
                }

                // åˆ¤æ–·æ˜¯å¦ç‚ºæœˆæœ«ç¸½çµæ—¥
                if (dateKey === lastDayDateKey) {
                    cell.classList.add('is-month-end');
                    // æœˆæœ«ç¸½çµæ—¥ï¼Œé»æ“Šå¾Œå°èˆªåˆ°æ—¥èªŒé é¢ (ç„¡è«–æ˜¯å¦å·²å‰µå»ºç¸½çµ)
                    cell.onclick = (function(key) {
                        return function() {
                            navigateTo('day', key);
                        };
                    })(dateKey);

                } else {
                    // æ™®é€šæ—¥æœŸï¼Œé»æ“Šå¾Œå°èˆªåˆ°æ—¥èªŒé é¢
                    cell.onclick = (function(key) { return function() { navigateTo('day', key); }; })(dateKey);
                }

                CALENDAR_GRID.appendChild(cell);
            }
        }

        // --- å–®æ—¥å…§å®¹æ¸²æŸ“ ---
        function renderDayView(dateStr) {
            document.getElementById('day-title').textContent = `LOGS FOR ${dateStr}`;
            DAY_TIMELINE.innerHTML = '';
            const dateObj = new Date(dateStr + 'T00:00:00');
            document.getElementById('current-date').textContent = getFormattedDate(dateObj, 'YYYY/MM/DD');

            const dayEntries = allEntries.filter(e => e.dateStr === dateStr)
                                       .sort((a, b) => b.id - a.id); // åå‘æ’åºï¼Œæœ€æ–°çš„åœ¨ä¸Šé¢

            if (dayEntries.length === 0) {
                DAY_TIMELINE.innerHTML = '<p style="text-align:center; font-size:10px; padding-top: 50px; color: var(--stardew-brown);">NO ENTRIES FOR THIS DATE. BE THE FIRST TO LOG!</p>';

                // å¦‚æœæ˜¯æœˆæœ«æ—¥ï¼Œæä¾›å¿«æ·å…¥å£å‰µå»ºç¸½çµ
                const daysInMonth = new Date(dateObj.getFullYear(), dateObj.getMonth() + 1, 0).getDate();
                if (dateObj.getDate() === daysInMonth) {
                    const quickSummaryBtn = document.createElement('button');
                    quickSummaryBtn.className = 'btn-pixel';
                    quickSummaryBtn.style = 'background-color: var(--stardew-purple); color: #fff; margin: 20px auto; display: block;';
                    quickSummaryBtn.textContent = 'CREATE MONTHLY SUMMARY';
                    quickSummaryBtn.onclick = () => openSummaryModal(dateStr);
                    DAY_TIMELINE.appendChild(quickSummaryBtn);
                }

                return;
            }

            // å¦‚æœæ˜¯æœˆæœ«æ—¥ï¼Œä¸”æ²’æœ‰ç¸½çµï¼Œæä¾›å‰µå»ºç¸½çµçš„æŒ‰éˆ•
            const daysInMonth = new Date(dateObj.getFullYear(), dateObj.getMonth() + 1, 0).getDate();
            const hasSummary = dayEntries.some(e => e.type === SUMMARY_TYPE);
            if (dateObj.getDate() === daysInMonth && !hasSummary) {
                const quickSummaryBtn = document.createElement('button');
                quickSummaryBtn.className = 'btn-pixel';
                quickSummaryBtn.style = 'background-color: var(--stardew-purple); color: #fff; margin: 20px auto 40px auto; display: block;';
                quickSummaryBtn.textContent = 'CREATE MONTHLY SUMMARY';
                quickSummaryBtn.onclick = () => openSummaryModal(dateStr);
                DAY_TIMELINE.appendChild(quickSummaryBtn);
            }

            // æ¸²æŸ“æ—¥èªŒæ¢ç›®
            dayEntries.forEach(entry => {
                DAY_TIMELINE.appendChild(createEntryElement(entry));
            });

            // å¦‚æœæ˜¯æœˆæœ«æ—¥ï¼Œä¸”æœ‰ç¸½çµï¼Œæä¾›ç·¨è¼¯ç¸½çµçš„æŒ‰éˆ•
            if (dateObj.getDate() === daysInMonth && hasSummary) {
                const editSummaryBtn = document.createElement('button');
                editSummaryBtn.className = 'btn-pixel';
                editSummaryBtn.style = 'background-color: var(--stardew-purple); color: #fff; margin: 20px auto 40px auto; display: block;';
                editSummaryBtn.textContent = 'EDIT MONTHLY SUMMARY';
                editSummaryBtn.onclick = () => openSummaryModal(dateStr);
                DAY_TIMELINE.appendChild(editSummaryBtn);
            }
        }

        // --- åˆªé™¤åŠŸèƒ½ ---
        function deleteEntry(id, dateStr) {
            // ä½¿ç”¨è‡ªå®šç¾©çš„æ¨¡æ…‹æˆ–ç¢ºèªå°è©±æ¡†ä¾†æ›¿ä»£ alert/confirm
            if (!window.confirm("ç¢ºå®šè¦åˆªé™¤é€™æ¢æ—¥èªŒå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚")) { return; }
            allEntries = allEntries.filter(entry => entry.id !== id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allEntries));
            calculateLoveValue();

            // åˆ¤æ–·ç•¶å‰æ˜¯å¦é‚„åœ¨æ—¥èªŒé é¢ï¼Œæ˜¯å‰‡åˆ·æ–°
            if (DAY_VIEW.classList.contains('view-active')) {
                renderDayView(dateStr);
            }
            renderCalendar();
        }
        window.deleteEntry = deleteEntry;


        // --- è¡¨å–®é‚è¼¯ï¼šæ™®é€šæ—¥èªŒ ---

        function toggleContentRequired() {
            if (ENTRY_TYPE_SELECT.value === 'photo') {
                CONTENT_TEXTAREA.removeAttribute('required');
                CONTENT_TEXT_GROUP.style.opacity = '0.5';
                CONTENT_TEXT_GROUP.style.pointerEvents = 'none';
                FILE_INPUT.setAttribute('required', 'required');
            } else {
                CONTENT_TEXTAREA.setAttribute('required', 'required');
                CONTENT_TEXT_GROUP.style.opacity = '1';
                CONTENT_TEXT_GROUP.style.pointerEvents = 'all';
                FILE_INPUT.removeAttribute('required');
            }
        }

        function openForm() {
            MODAL.style.display = 'flex';
            FORM.reset();
            FILE_LABEL.textContent = 'CLICK TO SELECT FILE ğŸ“·';
            // è¨­ç½®é è¨­æ—¥æœŸç‚ºç•¶å‰é¸æ“‡çš„æ—¥æ›†æœˆä»½ä¸­çš„ç•¶å‰æ—¥æœŸ
            const today = new Date();
            const defaultDate = new Date(currentDisplayYear, currentDisplayMonth, today.getDate());
            document.getElementById('entry-date').value = getFormattedDate(defaultDate, 'YYYY-MM-DD');
            toggleContentRequired();
        }
        function closeForm() { MODAL.style.display = 'none'; }

        FILE_INPUT.addEventListener('change', (e) => {
            FILE_LABEL.textContent = e.target.files.length > 0 ? `File Selected: ${e.target.files[0].name}` : 'CLICK TO SELECT FILE ğŸ“·';
        });

        async function handleEntrySubmit(e) {
            e.preventDefault();

            const dateInput = document.getElementById('entry-date').value;
            const entryType = ENTRY_TYPE_SELECT.value;
            const file = FILE_INPUT.files[0];
            let imageDataURL = null;

            if (entryType === 'photo' && !file && FILE_INPUT.hasAttribute('required')) {
                window.alert("åœ–ç‰‡æ¨¡å¼éœ€è¦ä¸Šå‚³åœ–ç‰‡æª”æ¡ˆã€‚"); // ä½¿ç”¨ window.alert æ›¿ä»£ confirm
                return;
            }

            if (file) {
                // é™åˆ¶åœ–ç‰‡å¤§å°é¿å… localStorage çˆ†ç‚¸
                if (file.size > 2 * 1024 * 1024) { // 2MB
                    window.alert("åœ–ç‰‡æª”æ¡ˆéå¤§ (é™åˆ¶ 2MB)ï¼Œè«‹å£“ç¸®å¾Œå†ä¸Šå‚³ã€‚");
                    return;
                }
                imageDataURL = await fileToBase64(file);
            }

            const newEntry = {
                id: Date.now(),
                author: document.getElementById('entry-author').value,
                dateStr: dateInput,
                date: getFormattedDate(new Date(dateInput), 'YYYY/MM/DD'),
                weather: document.getElementById('entry-weather').value,
                mood: document.getElementById('entry-mood').value,
                title: document.getElementById('entry-title').value,
                content: document.getElementById('entry-content').value,
                type: entryType,
                imageDataURL: imageDataURL,
            };

            saveEntry(newEntry);
            loadAndRenderAll();
            navigateTo('day', newEntry.dateStr);
            closeForm();
        }

        function saveEntry(newEntry) {
            allEntries.push(newEntry);
            // é‡æ–°æ’åºä»¥ä¾¿ç®¡ç† (é›–ç„¶æ¸²æŸ“æ™‚æœƒå†æ¬¡æ’åº)
            allEntries.sort((a, b) => a.dateStr.localeCompare(b.dateStr) || a.id - b.id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allEntries));
        }


        // --- è¡¨å–®é‚è¼¯ï¼šæœˆæœ«ç¸½çµ ---

        function openSummaryModal(dateStr) {
            const dateObj = new Date(dateStr + 'T00:00:00');
            const month = dateObj.getMonth() + 1;
            const year = dateObj.getFullYear();

            currentSummaryDateStr = dateStr; // Store for submission

            document.getElementById('summary-month-title').textContent = `${year} / ${month} MONTHLY REVIEW`;

            // Check if summary already exists for pre-filling
            const existingSummary = allEntries.find(e => e.dateStr === dateStr && e.type === SUMMARY_TYPE);

            if (existingSummary) {
                document.getElementById('summary-ll-review').value = existingSummary.ll.review || '';
                document.getElementById('summary-ll-improve').value = existingSummary.ll.improve || '';
                document.getElementById('summary-ll-expect').value = existingSummary.ll.expect || '';

                document.getElementById('summary-kk-review').value = existingSummary.kk.review || '';
                document.getElementById('summary-kk-improve').value = existingSummary.kk.improve || '';
                document.getElementById('summary-kk-expect').value = existingSummary.kk.expect || '';
            } else {
                SUMMARY_FORM.reset();
            }

            SUMMARY_MODAL.style.display = 'flex';
        }
        window.openSummaryModal = openSummaryModal;

        function closeSummaryModal() {
            SUMMARY_MODAL.style.display = 'none';
            currentSummaryDateStr = null;
        }
        window.closeSummaryModal = closeSummaryModal;

        function handleSummarySubmit(e) {
            e.preventDefault();

            if (!currentSummaryDateStr) {
                window.alert("éŒ¯èª¤ï¼šç„¡æ³•ç¢ºå®šç¸½çµæ—¥æœŸã€‚");
                return;
            }

            // 1. æ”¶é›†æ•¸æ“š
            const llData = {
                review: document.getElementById('summary-ll-review').value,
                improve: document.getElementById('summary-ll-improve').value,
                expect: document.getElementById('summary-ll-expect').value,
            };
            const kkData = {
                review: document.getElementById('summary-kk-review').value,
                improve: document.getElementById('summary-kk-improve').value,
                expect: document.getElementById('summary-kk-expect').value,
            };

            const dateObj = new Date(currentSummaryDateStr + 'T00:00:00');

            const newSummaryEntry = {
                id: Date.now(),
                dateStr: currentSummaryDateStr,
                date: getFormattedDate(dateObj, 'YYYY/MM/DD'),
                type: SUMMARY_TYPE,
                ll: llData,
                kk: kkData,
            };

            // 2. ç§»é™¤èˆŠç¸½çµ (å¦‚æœæœ‰)
            allEntries = allEntries.filter(e => e.dateStr !== currentSummaryDateStr || e.type !== SUMMARY_TYPE);

            // 3. å„²å­˜æ–°ç¸½çµ
            saveEntry(newSummaryEntry); // saveEntry function handles push and storage
            loadAndRenderAll();
            closeSummaryModal();
            navigateTo('day', newSummaryEntry.dateStr);
        }

        // --- Utility Functions ---

        /** æ ¼å¼åŒ–æ—¥æœŸ */
        function getFormattedDate(date, format) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return format.replace('YYYY', y).replace('MM', m).replace('DD', d);
        }

        /** æª”æ¡ˆè½‰ Base64 */
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        /** å‰µå»ºæ—¥èªŒæ¢ç›® (æ™®é€šæ—¥èªŒ/åœ–ç‰‡æ—¥èªŒ/ç¸½çµ) çš„ DOM å…ƒç´  */
        function createEntryElement(entry) {
            const entryDiv = document.createElement('div');
            entryDiv.className = `memory-entry author-${entry.author}`;
            entryDiv.dataset.id = entry.id;

            if (entry.type === SUMMARY_TYPE) {
                // æœˆæœ«ç¸½çµæ¸²æŸ“
                entryDiv.classList.remove('author-LL', 'author-KK', 'memory-entry'); // ç§»é™¤æ™®é€šæ—¥èªŒæ¨£å¼
                entryDiv.style.width = '100%';
                entryDiv.style.margin = '0';
                entryDiv.classList.add('entry-month-summary');
                entryDiv.innerHTML = `
                    <div class="summary-header">
                        <span style="font-size: 8px;">Month End Log</span>
                        <h3>${entry.dateStr.substring(0, 7)} æœˆç¸½çµ (MONTHLY REVIEW)</h3>
                        <button class="delete-btn" onclick="deleteEntry(${entry.id}, '${entry.dateStr}')">DELETE</button>
                    </div>
                    <div class="summary-content-wrapper">
                        <div class="summary-section-column">
                            <h4 style="color: ${getComputedStyle(document.documentElement).getPropertyValue('--stardew-blue')}">LL's Perspective</h4>
                            <div class="summary-section">
                                <h4>æœ¬æœˆå¾©ç›¤:</h4><p>${entry.ll.review || 'N/A'}</p>
                            </div>
                            <div class="summary-section">
                                <h4>å¾…æ”¹é€²:</h4><p>${entry.ll.improve || 'N/A'}</p>
                            </div>
                            <div class="summary-section">
                                <h4>å° KK çš„æœŸå¾…:</h4><p>${entry.ll.expect || 'N/A'}</p>
                            </div>
                        </div>

                        <div class="summary-section-column">
                            <h4 style="color: ${getComputedStyle(document.documentElement).getPropertyValue('--stardew-pink')}">KK's Perspective</h4>
                            <div class="summary-section">
                                <h4>æœ¬æœˆå¾©ç›¤:</h4><p>${entry.kk.review || 'N/A'}</p>
                            </div>
                            <div class="summary-section">
                                <h4>å¾…æ”¹é€²:</h4><p>${entry.kk.improve || 'N/A'}</p>
                            </div>
                            <div class="summary-section">
                                <h4>å° LL çš„æœŸå¾…:</h4><p>${entry.kk.expect || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                    <p style="text-align: right; font-size: 7px; margin-top: 15px;">Logged on: ${entry.date}</p>
                `;
                return entryDiv;
            }

            // æ™®é€šæ—¥èªŒæ¸²æŸ“
            entryDiv.innerHTML = `
                <div style="font-size: 10px; font-weight: bold; margin-bottom: 5px; display: flex; justify-content: space-between;">
                    <span>[${entry.author}] ${entry.title}</span>
                    <button class="delete-btn" onclick="deleteEntry(${entry.id}, '${entry.dateStr}')">DELETE</button>
                </div>
                <div style="font-size: 8px; margin-bottom: 10px; opacity: 0.8;">
                    ğŸ“… ${entry.date} &nbsp; ${entry.weather} &nbsp; ${entry.mood}
                </div>
                ${entry.type === 'photo' && entry.imageDataURL
                    ? `<img src="${entry.imageDataURL}" style="max-width: 100%; height: auto; margin-top: 10px; border: 2px solid #fff; box-shadow: 2px 2px 0 0 #000; image-rendering: pixelated;"/>
                       <p style="font-size: 8px; margin-top: 10px; line-height: 1.4; word-break: break-word;">${entry.content}</p>`
                    : `<p style="font-size: 10px; line-height: 1.6; word-break: break-word;">${entry.content}</p>`
                }
            `;
            return entryDiv;
        }


        // --- Settings / Data Transfer Functions ---

        function openSettingsModal() { SETTINGS_MODAL.style.display = 'flex'; }
        window.openSettingsModal = openSettingsModal;

        function closeSettingsModal() { SETTINGS_MODAL.style.display = 'none'; }
        window.closeSettingsModal = closeSettingsModal;

        function exportLogs() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(allEntries, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `stardew_logbook_backup_${getFormattedDate(new Date(), 'YYYYMMDD')}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            window.alert("æ—¥èªŒå·²åŒ¯å‡ºï¼è«‹æª¢æŸ¥æ‚¨çš„ä¸‹è¼‰æ–‡ä»¶å¤¾ã€‚");
        }
        window.exportLogs = exportLogs;

        function importLogs(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (!window.confirm(`ç¢ºå®šè¦åŒ¯å…¥æª”æ¡ˆ "${file.name}" å—ï¼Ÿ\næ­¤æ“ä½œå°‡è¦†è“‹æ‚¨æ‰€æœ‰çš„ç¾æœ‰æ—¥èªŒï¼`)) {
                e.target.value = ''; // æ¸…ç©ºæª”æ¡ˆè¼¸å…¥
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const importedData = JSON.parse(event.target.result);
                    if (Array.isArray(importedData)) {
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(importedData));
                        loadAndRenderAll();
                        window.alert("æ—¥èªŒåŒ¯å…¥æˆåŠŸï¼æ‡‰ç”¨ç¨‹å¼å·²åˆ·æ–°ã€‚");
                        closeSettingsModal();
                        navigateTo('calendar');
                    } else {
                        throw new Error("åŒ¯å…¥çš„æª”æ¡ˆæ ¼å¼ä¸æ­£ç¢ºï¼Œé æœŸç‚ºæ—¥èªŒé™£åˆ—ã€‚");
                    }
                } catch (error) {
                    console.error("Data import failed:", error);
                    window.alert(`åŒ¯å…¥å¤±æ•—: ${error.message}. è«‹ç¢ºä¿æª”æ¡ˆæ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼ã€‚`);
                }
                e.target.value = ''; // æ¸…ç©ºæª”æ¡ˆè¼¸å…¥
            };
            reader.readAsText(file);
        }
        // importLogs is attached via event listener in DOMContentLoaded

        function wipeData() {
            if (window.confirm("ğŸš¨ è­¦å‘Šï¼šç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ—¥èªŒæ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ï¼")) {
                localStorage.removeItem(STORAGE_KEY);
                allEntries = [];
                loadAndRenderAll();
                window.alert("æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤ã€‚æ‡‰ç”¨ç¨‹å¼å·²é‡ç½®ã€‚");
                closeSettingsModal();
                navigateTo('calendar');
            }
        }
        window.wipeData = wipeData;

        // å°‡é‡è¦å‡½æ•¸æš´éœ²çµ¦å…¨å±€ç¯„åœï¼Œä»¥ä¾¿ HTML å…§è¯äº‹ä»¶èª¿ç”¨
        window.toggleContentRequired = toggleContentRequired;
        window.openForm = openForm;
        window.closeForm = closeForm;
        window.openSummaryModal = openSummaryModal;
        window.closeSummaryModal = closeSummaryModal;
        window.navigateTo = navigateTo;
    </script>
</body>
</html>